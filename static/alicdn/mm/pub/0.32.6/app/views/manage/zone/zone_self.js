Magix.tmpl("app/views/manage/zone/zone_self","<div class=table-container bx-name=\"fixed_head\" bx-path=\"components/fixed_head/\"> <div class=table-head-fix> <table class=table bx-tmpl=\"tableFix\" bx-datakey=\"list\"> <thead> <tr {{^list}}class=no-data{{/list}}> <th class=left>推广位名称</th> <th class=left width=\"15%\">pid</th> <th class=left width=\"8%\">所属导购</th> <th class=left width=\"8%\">推广类型</th> <th class=left width=\"8%\">30天点击数</th> <th class=left width=\"8%\">30天付款笔数</th> <th class=left width=\"8%\">30天效果预估</th> <th class=left width=\"8%\">30天预估收入</th> <th class=center width=\"20%\">操作</th> </tr> </thead> </table> </div> <table class=table bx-name=\"tables\" bx-tmpl=\"list\" bx-datakey=\"list,pubHost\"> <tbody> {{#list}} <tr> <td class=left>{{name}}</td> <td class=left width=\"15%\">{{adzonePid}}</td> <td class=left width=\"8%\">{{sitename}}</td> <td class=left width=\"8%\">{{list_tag}}</td> <td class=left width=\"8%\">{{mixClick30day}}</td> <td class=left width=\"8%\">{{mixAlipayNum30day}}</td> <td class=left width=\"8%\">￥{{list_alipayRec30day}}</td> <td class=left width=\"8%\">￥{{list_rec30day}}</td> <td class=center width=\"20%\"> <p class=operation> {{#list_zoneType}} <a href=\"#!/report/zone/{{list_zoneType}}?adzoneId={{adzoneid}}\" data-spm-click=\"gostr=/tblm.88.1;locaid=d0cdfe4df\">效果报表</a> {{/list_zoneType}} {{^list_zoneType}} <span class=color-gray>效果报表</sapn> {{/list_zoneType}} {{#autoGeneratedSite}} <span class=divide>|</span> <span class=color-gray>修改</span> <span class=divide>|</span> <span class=color-gray>删除</span> {{/autoGeneratedSite}} {{^autoGeneratedSite}} <span class=divide>|</span> <a href=\"#\" mx-click=\"edit{adzoneId:{{adzoneid}}}\" data-spm-click=\"gostr=/tblm.88.1;locaid=d6fff4036\">修改</a> <span class=divide>|</span> <a class=\"\" href=\"#\" mx-click=\"del{adzoneId:{{adzoneid}}}\" data-spm-click=\"gostr=/tblm.88.1;locaid=d0e3dbeca\">删除</a> {{/autoGeneratedSite}} </p> </td> </tr> {{/list}} {{^list}} <tr class=none> <td colspan=7>暂无数据</td> </tr> {{/list}} </tbody> </table> <div class=tfoot> <div id=J_item_pagination bx-name=\"pagination\" class=pagination bx-config=\"{count:{{pageCount}},index:{{pageNo}},size:{{pageSize}},sizes:[40],simplify:true,statistics:true,sizeChange:true,jump:true,goTo:false}\"> </div> </div>");
KISSY.add('app/views/manage/zone/zone_self', function (S, View, VOM, Node, MM, Router, Util) {
    var $ = Node.all;
    return View.extend({
        init: function (e) {
            var me = this;
            me.on('prev', function (ev) {
                me.events.click.edit(ev.event);
            });
            me.on('save', function (ev) {
                me.events.click.edit(ev.event);
            });
        },
        locationChange: function (e) {
            this.render();
        },
        render: function () {
            var me = this;
            var loc = me.location;
            var params = S.clone(loc.params);
            params.toPage = params.toPage || 1;
            params.perPageSize = params.perPageSize || 40;
            params.gcid = 8;
            me.manage(MM.fetchAll([{
                    name: 'zone_list',
                    urlParams: params
                }], function (MesModel) {
                var totalData = MesModel.get('data');
                var list = totalData.pagelist;
                var pageCount = totalData.paginator ? totalData.paginator.items : 0;
                me.manage('totalData', totalData);
                me.setViewPagelet({
                    list: list,
                    pageCount: pageCount,
                    pageNo: params.toPage,
                    pageSize: params.perPageSize,
                    pubHost: window.UserInfo.pubHost
                }, function () {
                    me.components();
                }, function () {
                    var pageParams = {
                        pageNo: params.toPage,
                        pageSize: params.perPageSize,
                        pageCount: pageCount
                    };
                    me.resetPage(pageParams);
                });
            }));
        },
        components: function () {
            var me = this;
            var pagelet = me.getManaged('pagelet');
            var pagination = pagelet.getBrick('J_item_pagination');
            if (pagination) {
                pagination.on('gotoPage', function (ev) {
                    me.navigate('toPage=' + ev.index);
                });
                pagination.on('sizeChange', function (ev) {
                    me.navigate('toPage=1&perPageSize=' + ev.size);
                });
            }
        },
        resetPage: function (params) {
            var me = this;
            var pagelet = me.getManaged('pagelet');
            var pagination = pagelet.getBrick('J_item_pagination');
            var pageparam = {};
            if (pagination) {
                if (pagination.get('index') != params.pageNo) {
                    pageparam['index'] = params.pageNo;
                }
                if (pagination.get('size') != params.pageSize) {
                    pageparam['size'] = params.pageSize;
                }
                if (pagination.get('count') != params.pageCount) {
                    pageparam['count'] = params.pageCount;
                }
                if (!S.isEmptyObject(pageparam)) {
                    pagination.setConfig(pageparam);
                }
            }
        },
        events: {
            click: {
                edit: function (e) {
                    e.halt();
                    var me = e.view;
                    var top = $('#' + e.currentId).parent('tr').offset().top;
                    var dialogConfig = Util.getDefaultDialogConfig({ top: top });
                    var viewName = 'app/views/manage/zone/zone_edit';
                    var viewOptions = {
                        top: top,
                        triggerView: me,
                        event: e,
                        adzoneId: e.params.adzoneId,
                        callback: function () {
                            me.render();
                        }
                    };
                    Util.showDialog(dialogConfig, viewName, viewOptions);
                },
                del: function (e) {
                    e.halt();
                    var me = e.view;
                    var top = $('#' + e.currentId).parent('tr').offset().top;
                    var dialogConfig = Util.getDefaultDialogConfig({
                        width: 300,
                        top: top
                    });
                    var viewName = 'app/views/util/confirm';
                    var viewOptions = {
                        confirmFn: function () {
                            me.manage(MM.fetchAll([{
                                    name: 'zone_del',
                                    postParams: {
                                        gcid: 8,
                                        adzoneids: e.params.adzoneId
                                    }
                                }], function (MesModel) {
                                Util.hideDialog();
                                me.render();
                            }), function (err) {
                                alert(err.message);
                                return;
                            });
                        },
                        cancelFn: function () {
                            Util.hideDialog();
                        },
                        confirmTitle: '\u5220\u9664\u63A8\u5E7F\u4F4D',
                        confirmContent: '\u60A8\u786E\u5B9A\u8981\u5220\u9664\u6B64\u63A8\u5E7F\u4F4D\u5417\uFF1F'
                    };
                    Util.showDialog(dialogConfig, viewName, viewOptions);
                }
            }
        },
        renderer: {
            list: {
                tag: function (self) {
                    switch (this.tag) {
                    case '1':
                        return '\u9891\u9053';
                    case '3':
                        return '\u5145\u503C\u6846';
                    case '6':
                        return '\u7EC4\u4EF6';
                    case '29':
                        return '\u81EA\u52A9';
                    case '49':
                        return '\u5FAE\u5BFC\u8D2D';
                    case '50':
                        return '\u6DD8\u5B9D\u54C7\u54E6';
                    case '59':
                        return '\u4E3B\u9898\u6D3B\u52A8';
                    case '60':
                        return '\u963F\u91CC\u84B2\u516C\u82F1';
                    }
                },
                mixCtr30day: function (self) {
                    return Util.formatNumber(this.mixCtr30day).join('.');
                },
                zoneType: function () {
                    switch (this.tag) {
                    case '29':
                        return 'zone_self';
                        break;
                    case '59':
                        return 'zone_act';
                        break;
                    default:
                        return '';
                        break;
                    }
                },
                rec30day: function (self) {
                    return Util.formatNumber(this.rec30day).join('.');
                },
                alipayRec30day: function (self) {
                    return Util.formatNumber(this.mixAlipayRec30day).join('.');
                }
            }
        }
    });
}, {
    requires: [
        'mxext/view',
        'magix/vom',
        'node',
        'app/models/modelmanager',
        'magix/router',
        'app/util/util',
        'mxext/mmanager',
        'app/models/model',
        'app/models/basemodel',
        'mxext/model',
        'ajax',
        'app/util/datepicker/datepicker',
        'app/util/dialog/dialog',
        'app/util/format/format',
        'app/util/globaltip/globaltip',
        'app/util/robot/sourceid',
        'app/util/spmlog/spmlog',
        'app/util/mathextend/mathextend',
        'app/util/tooltip/tooltip',
        'app/util/widgetds/widgetds',
        'app/util/rank/rank',
        'app/util/reporttip/reporttip',
        'app/util/vcode/vcode',
        'app/util/pagination/index',
        'app/util/fields/fields',
        'app/util/mouseevent/index',
        'magix/vframe',
        'brix/gallery/datepicker/index',
        'brix/gallery/calendar/index',
        'brix/gallery/dialog/index',
        'app/util/spmlog/pathmap'
    ]
});